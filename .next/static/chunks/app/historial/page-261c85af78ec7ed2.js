(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{5895:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>I});var a=s(5155),l=s(2115),i=s(6622),r=s(8500),n=s.n(r),d=s(8751),o=s(642),c=s(723),x=s(4478),m=s(1878),p=s(6296),h=s(4961),u=s(3545),g=s(9372),b=s(2484),f=s(9),j=s(4980),N=s(9921),w=s(6088),v=s(3210),y=s(6662),k=s(5237),z=s(4514),A=s(7635);function C({message:e,type:t="error",isVisible:s,onClose:i}){return(0,l.useEffect)(()=>{if(s){let e=setTimeout(i,3e3);return()=>clearTimeout(e)}},[s,i]),(0,a.jsx)(o.N,{children:s&&(0,a.jsx)(d.P.div,{initial:{opacity:0,y:-50,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.9},transition:{type:"spring",stiffness:300,damping:20},className:"fixed top-6 left-0 right-0 z-[10000] flex justify-center px-4 pointer-events-none",children:(0,a.jsxs)("div",{className:`pointer-events-auto flex items-center gap-3 px-5 py-3.5 rounded-full shadow-2xl backdrop-blur-xl border ${"error"===t?"bg-white/90 text-red-600 border-red-100 shadow-red-500/10":"bg-white/90 text-emerald-600 border-emerald-100 shadow-emerald-500/10"}`,children:["error"===t?(0,a.jsx)(u.A,{size:20,strokeWidth:2.5}):(0,a.jsx)(b.A,{size:20,strokeWidth:2.5}),(0,a.jsx)("p",{className:"text-sm font-bold text-gray-800 pr-2",children:e}),(0,a.jsx)("button",{onClick:i,className:"p-1 hover:bg-gray-100 rounded-full transition-colors",children:(0,a.jsx)(v.A,{size:14,className:"text-gray-400"})})]})})})}function I(){let[e,t]=(0,l.useState)(""),[s,r]=(0,l.useState)(!1),[I,_]=(0,l.useState)([]),[S,P]=(0,l.useState)(!1),[D,E]=(0,l.useState)(null),[F,q]=(0,l.useState)(null),[T,O]=(0,l.useState)(!1),[$,J]=(0,l.useState)("qr"),[M,Q]=(0,l.useState)(!1),[R,Z]=(0,l.useState)(!1),[L,Y]=(0,l.useState)(""),[H,V]=(0,l.useState)({show:!1,message:"",type:"error"}),X=(0,i.createBrowserClient)("https://qmpymxajjxlfnlfybaqt.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFtcHlteGFqanhsZm5sZnliYXF0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2OTI4NjIsImV4cCI6MjA4NjI2ODg2Mn0.Oo4KnFI-Y6xkeI2xbEQ8zQBE7y63ZaztwbQvbU7bgiE");(0,l.useEffect)(()=>{if(!S||!e)return;let t=X.channel(`historial-${e}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"orders",filter:`customer_dni=eq.${e}`},e=>{_(t=>t.map(t=>t.id===e.new.id?{...t,...e.new}:t))}).subscribe();return()=>{X.removeChannel(t)}},[S,e]);let B=async t=>{if(t.preventDefault(),8!==e.length)return void V({show:!0,message:"DNI inv\xe1lido (debe tener 8 d\xedgitos)",type:"error"});r(!0),P(!0),q(null);let{data:s}=await X.from("customers").select("*").eq("dni",e).single();if(E(s),s){let{data:t}=await X.from("orders").select("*").eq("customer_dni",e).order("created_at",{ascending:!1}).limit(50);_(t||[])}else _([]);r(!1)},G=async()=>{if(!L)return void V({show:!0,message:"Falta el c\xf3digo de operaci\xf3n",type:"error"});Z(!0);let e=I.filter(e=>["on_account","unpaid"].includes(e.payment_status)).map(e=>e.id);if(0===e.length)return void Z(!1);let{error:t}=await X.from("orders").update({payment_status:"verifying",payment_method:"yape",operation_code:L}).in("id",e);Z(!1),t?V({show:!0,message:"Error al enviar",type:"error"}):(V({show:!0,message:"Enviado a revisi\xf3n",type:"success"}),O(!1),Y(""),_(I.map(t=>e.includes(t.id)?{...t,payment_status:"verifying",operation_code:L}:t)))},U=I.filter(e=>["on_account","unpaid"].includes(e.payment_status)).reduce((e,t)=>e+t.total_amount,0);return(0,a.jsxs)("div",{className:"min-h-screen bg-[#F8F9FA] pb-32 font-sans text-slate-800 selection:bg-orange-100 selection:text-orange-900",children:[(0,a.jsx)(C,{isVisible:H.show,message:H.message,type:H.type,onClose:()=>V({...H,show:!1})}),(0,a.jsxs)("header",{className:"sticky top-0 z-30 px-4 py-3 bg-white/80 backdrop-blur-xl border-b border-slate-200/60 flex items-center gap-4 safe-area-top",children:[(0,a.jsx)(n(),{href:"/",className:"p-2.5 bg-white border border-slate-200 rounded-full hover:bg-slate-50 transition-colors active:scale-90 shadow-sm text-slate-500",children:(0,a.jsx)(c.A,{size:20})}),(0,a.jsx)("h1",{className:"font-black text-lg text-slate-900 tracking-tight",children:"Estado de Cuenta"})]}),(0,a.jsxs)("main",{className:"max-w-md mx-auto p-4 mt-2 space-y-6",children:[(0,a.jsxs)(d.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-white p-6 rounded-[2rem] shadow-xl shadow-slate-200/50 border border-white",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,a.jsx)("div",{className:"bg-orange-100 text-orange-600 p-2.5 rounded-xl",children:(0,a.jsx)(x.A,{size:24})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-black text-slate-900 leading-none",children:"Consulta Segura"}),(0,a.jsx)("p",{className:"text-xs text-slate-400 font-medium mt-1",children:"Ingresa tu DNI para ver tu historial."})]})]}),(0,a.jsxs)("form",{onSubmit:B,className:"flex flex-col gap-3",children:[(0,a.jsxs)("div",{className:"relative group",children:[(0,a.jsx)("input",{type:"tel",inputMode:"numeric",maxLength:8,value:e,onChange:e=>{let s=e.target.value.replace(/\D/g,"");s.length<=8&&t(s)},placeholder:"DNI (8 d\xedgitos)",className:"w-full p-4 pl-12 bg-slate-50 rounded-2xl font-bold text-lg outline-none focus:ring-4 focus:ring-orange-500/10 border-2 border-transparent focus:border-orange-200 transition-all placeholder:text-slate-300 tracking-widest text-slate-800"}),(0,a.jsx)(m.A,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-orange-500 transition-colors",size:20})]}),(0,a.jsx)("button",{disabled:s||8!==e.length,className:"w-full bg-slate-900 text-white py-4 rounded-2xl font-bold text-base shadow-lg shadow-slate-900/20 hover:bg-black active:scale-[0.98] transition-all disabled:opacity-50 disabled:scale-100 flex items-center justify-center gap-2",children:s?(0,a.jsx)(p.A,{className:"animate-spin"}):"Consultar Historial"})]})]}),S&&(0,a.jsxs)(d.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:[!D&&(0,a.jsxs)("div",{className:"text-center py-10 px-6 bg-white rounded-[2rem] border border-slate-100 shadow-sm",children:[(0,a.jsx)("div",{className:"bg-slate-50 p-4 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4 shadow-inner",children:(0,a.jsx)(h.A,{className:"text-slate-300",size:40})}),(0,a.jsx)("h3",{className:"font-black text-slate-900 text-lg mb-1",children:"DNI No Registrado"}),(0,a.jsxs)("p",{className:"text-slate-500 text-sm mb-6 leading-relaxed",children:["No hemos encontrado pedidos asociados al DNI"," ",(0,a.jsx)("span",{className:"font-bold text-slate-800",children:e}),"."]}),(0,a.jsx)(n(),{href:"/",className:"inline-flex bg-orange-600 text-white px-6 py-3 rounded-xl font-bold text-sm shadow-lg shadow-orange-200 hover:bg-orange-700 transition-colors",children:"Hacer mi primer pedido"})]}),D&&(0,a.jsxs)("div",{className:"space-y-6",children:[U>0?(0,a.jsxs)(d.P.div,{initial:{scale:.95},animate:{scale:1},className:"bg-gradient-to-br from-orange-500 to-orange-600 text-white p-6 rounded-[2.5rem] shadow-2xl shadow-orange-500/40 relative overflow-hidden",children:[(0,a.jsx)("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full blur-3xl -mr-10 -mt-10"}),(0,a.jsxs)("div",{className:"relative z-10",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-3 opacity-90",children:[(0,a.jsx)("div",{className:"bg-white/20 p-1.5 rounded-lg",children:(0,a.jsx)(u.A,{size:16})}),(0,a.jsx)("p",{className:"font-bold uppercase tracking-widest text-[10px]",children:"Saldo Pendiente"})]}),(0,a.jsxs)("div",{className:"flex flex-col mb-6",children:[(0,a.jsxs)("span",{className:"text-5xl font-black tracking-tighter drop-shadow-md",children:["S/ ",U.toFixed(2)]}),(0,a.jsx)("span",{className:"text-orange-100 text-sm font-medium mt-1",children:"Tienes consumos por regularizar."})]}),(0,a.jsxs)("button",{onClick:()=>O(!0),className:"w-full bg-white text-orange-600 py-3.5 rounded-2xl font-black text-sm uppercase tracking-wide shadow-lg flex items-center justify-center gap-2 active:scale-95 transition-transform",children:[(0,a.jsx)(g.A,{size:18})," Pagar Deuda Ahora"]})]})]}):(0,a.jsxs)(d.P.div,{initial:{scale:.95},animate:{scale:1},className:"bg-emerald-500 text-white p-8 rounded-[2.5rem] shadow-2xl shadow-emerald-500/30 flex flex-col items-center text-center relative overflow-hidden",children:[(0,a.jsx)("div",{className:"absolute top-0 left-0 w-full h-full bg-gradient-to-b from-white/10 to-transparent"}),(0,a.jsx)("div",{className:"bg-white/20 p-4 rounded-full backdrop-blur-md mb-4 shadow-inner",children:(0,a.jsx)(b.A,{size:40,strokeWidth:2.5})}),(0,a.jsx)("h3",{className:"font-black text-2xl mb-1 relative z-10",children:"\xa1Todo al d\xeda!"}),(0,a.jsx)("p",{className:"text-emerald-100 text-sm font-medium relative z-10 px-4",children:"No tienes deudas pendientes. Gracias por tu puntualidad."})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-4 px-2",children:[(0,a.jsx)(f.A,{size:16,className:"text-slate-400"}),(0,a.jsx)("h3",{className:"font-black text-slate-400 uppercase tracking-widest text-xs",children:"Movimientos Recientes"})]}),(0,a.jsx)("div",{className:"space-y-4",children:I.map(e=>{let t=F===e.id,s="paid"===e.payment_status,l="verifying"===e.payment_status;return(0,a.jsxs)(d.P.div,{layout:!0,onClick:()=>q(t?null:e.id),className:`bg-white p-5 rounded-[1.8rem] border transition-all cursor-pointer overflow-hidden ${t?"border-orange-200 shadow-lg shadow-orange-500/5 ring-1 ring-orange-100":"border-slate-100 shadow-sm hover:shadow-md"}`,children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("div",{className:`w-12 h-12 rounded-2xl flex items-center justify-center shrink-0 ${s?"bg-emerald-50 text-emerald-600":l?"bg-purple-50 text-purple-600":"bg-orange-50 text-orange-600"}`,children:s?(0,a.jsx)(b.A,{size:20}):l?(0,a.jsx)(p.A,{size:20,className:"animate-spin"}):(0,a.jsx)(u.A,{size:20})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-bold text-slate-900 text-base capitalize",children:new Date(e.created_at).toLocaleDateString("es-PE",{weekday:"short",day:"numeric"})}),(0,a.jsxs)("div",{className:"flex items-center gap-1.5 mt-0.5",children:[(0,a.jsx)(j.A,{size:10,className:"text-slate-400"}),(0,a.jsx)("span",{className:"text-xs text-slate-400 font-medium",children:new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"font-black text-slate-900 text-lg tracking-tight",children:["S/ ",e.total_amount.toFixed(2)]}),(0,a.jsx)("span",{className:`inline-block px-2 py-0.5 rounded text-[9px] font-black uppercase tracking-wide ${s?"bg-emerald-100 text-emerald-700":l?"bg-purple-100 text-purple-700":"bg-orange-100 text-orange-700"}`,children:s?"Pagado":l?"Verificando":"Por Pagar"})]})]}),(0,a.jsx)(o.N,{children:t&&(0,a.jsx)(d.P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-dashed border-slate-100 space-y-3",children:[e.items.map((e,t)=>(0,a.jsxs)("div",{className:"flex justify-between items-start text-sm",children:[(0,a.jsxs)("div",{className:"flex gap-2.5",children:[(0,a.jsxs)("span",{className:"font-bold text-slate-500 text-xs mt-0.5",children:[e.qty,"x"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-bold text-slate-700 leading-tight",children:e.name}),e.options&&(0,a.jsxs)("div",{className:"text-[10px] text-slate-400 mt-0.5 flex flex-col gap-0.5",children:[e.options.entrada&&(0,a.jsxs)("span",{children:["• ",e.options.entrada]}),e.options.bebida&&(0,a.jsxs)("span",{children:["• ",e.options.bebida]})]})]})]}),(0,a.jsxs)("span",{className:"font-medium text-slate-900 text-xs",children:["S/ ",(e.price*e.qty).toFixed(2)]})]},t)),(0,a.jsx)("div",{className:"pt-2 flex justify-center",children:(0,a.jsx)(N.A,{size:16,className:"text-slate-300"})})]})})}),!t&&(0,a.jsx)("div",{className:"mt-3 flex justify-center",children:(0,a.jsx)(w.A,{size:16,className:"text-slate-300"})})]},e.id)})})]})]})]})]}),(0,a.jsx)(o.N,{children:T&&(0,a.jsxs)("div",{className:"fixed inset-0 z-[9999] flex items-end sm:items-center justify-center p-4 isolate",children:[(0,a.jsx)(d.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>O(!1),className:"absolute inset-0 bg-slate-900/60 backdrop-blur-sm"}),(0,a.jsxs)(d.P.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:25,stiffness:300},className:"relative bg-white w-full max-w-md rounded-[2.5rem] shadow-2xl p-6 pb-8 flex flex-col max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-black text-slate-900 leading-tight",children:"Pagar Deuda"}),(0,a.jsx)("p",{className:"text-xs text-slate-400 font-bold uppercase tracking-widest mt-0.5",children:"Regularizaci\xf3n"})]}),(0,a.jsx)("button",{onClick:()=>O(!1),className:"p-2 bg-slate-50 rounded-full hover:bg-slate-100 text-slate-400 transition-colors",children:(0,a.jsx)(v.A,{size:20})})]}),(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("p",{className:"text-xs text-orange-500 font-bold uppercase tracking-widest mb-1",children:"Total a Pagar"}),(0,a.jsxs)("p",{className:"text-5xl font-black text-slate-900 tracking-tighter",children:["S/ ",U.toFixed(2)]})]}),(0,a.jsx)("div",{className:"bg-white rounded-3xl border border-purple-100 shadow-xl shadow-purple-500/5 p-1 mb-6",children:(0,a.jsxs)("div",{className:"bg-purple-50/40 rounded-[1.5rem] p-5",children:[(0,a.jsxs)("div",{className:"flex bg-white p-1 rounded-xl shadow-sm border border-purple-50 mb-6",children:[(0,a.jsxs)("button",{onClick:()=>J("qr"),className:`flex-1 py-2.5 rounded-lg text-[10px] font-black uppercase transition-all flex items-center justify-center gap-2 ${"qr"===$?"bg-purple-600 text-white shadow-md":"text-slate-400 hover:bg-purple-50"}`,children:[(0,a.jsx)(y.A,{size:14})," QR"]}),(0,a.jsxs)("button",{onClick:()=>J("number"),className:`flex-1 py-2.5 rounded-lg text-[10px] font-black uppercase transition-all flex items-center justify-center gap-2 ${"number"===$?"bg-purple-600 text-white shadow-md":"text-slate-400 hover:bg-purple-50"}`,children:[(0,a.jsx)(k.A,{size:14})," N\xfamero"]})]}),(0,a.jsx)("div",{className:"flex flex-col items-center text-center",children:"qr"===$?(0,a.jsx)(d.P.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"bg-white p-3 rounded-2xl border-2 border-dashed border-purple-200 shadow-sm mb-4",children:(0,a.jsx)("img",{src:"/yape-qr.png",alt:"QR Yape",className:"w-32 h-32 object-contain rounded-lg"})}):(0,a.jsxs)(d.P.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"mb-4 w-full",children:[(0,a.jsx)("p",{className:"text-3xl font-black text-purple-900 tracking-tighter",children:"974 805 994"}),(0,a.jsx)("p",{className:"text-[10px] font-bold text-purple-600 uppercase mt-1",children:"Irma Cerna Hoyos"}),(0,a.jsxs)("button",{onClick:()=>{navigator.clipboard.writeText("974805994"),Q(!0),setTimeout(()=>Q(!1),2e3)},className:"mt-3 w-full py-2.5 bg-white border border-purple-200 rounded-xl text-purple-700 text-xs font-bold shadow-sm flex items-center justify-center gap-2 active:scale-95 transition-transform",children:[M?(0,a.jsx)(z.A,{size:14}):(0,a.jsx)(A.A,{size:14})," ",M?"Copiado":"Copiar"]})]})}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("label",{className:"text-[9px] font-black text-purple-400 uppercase tracking-widest pl-2 mb-1 block",children:"C\xf3digo de Operaci\xf3n"}),(0,a.jsx)("input",{value:L,onChange:e=>{Y(e.target.value.replace(/\D/g,""))},maxLength:6,placeholder:"000000",inputMode:"numeric",className:"w-full h-14 text-center text-2xl font-black text-purple-900 bg-white border border-purple-100 rounded-2xl focus:border-purple-300 focus:ring-4 focus:ring-purple-500/10 outline-none tracking-[0.3em] placeholder:text-purple-100 transition-all"})]})]})}),(0,a.jsx)("button",{onClick:G,disabled:R,className:"w-full bg-slate-900 text-white py-4 rounded-2xl font-bold text-base shadow-xl shadow-slate-900/20 hover:bg-black active:scale-[0.98] transition-all disabled:opacity-70 flex items-center justify-center gap-2",children:R?(0,a.jsx)(p.A,{className:"animate-spin"}):"Enviar Comprobante"})]})]})})]})}},6417:(e,t,s)=>{Promise.resolve().then(s.bind(s,5895))}},e=>{e.O(0,[525,416,500,113,441,928,358],()=>e(e.s=6417)),_N_E=e.O()}]);
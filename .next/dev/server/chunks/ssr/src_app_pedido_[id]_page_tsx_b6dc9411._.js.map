{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/yammir/Documents/Yammir/DOCUMENTOSSSS%20ANTES%20DE%20LA%20ACRTUALIZACION/WEB%C2%B4S/d-irma/src/app/pedido/%5Bid%5D/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { createBrowserClient } from \"@supabase/ssr\";\nimport { useParams } from \"next/navigation\";\nimport Link from \"next/link\";\nimport {\n  CheckCircle,\n  Clock,\n  ChefHat,\n  MapPin,\n  ArrowLeft,\n  MessageCircle,\n  Loader2,\n  Receipt,\n} from \"lucide-react\";\nimport { motion } from \"framer-motion\";\n\nexport default function OrderStatusPage() {\n  const { id } = useParams();\n  const [order, setOrder] = useState<any>(null);\n  const [loading, setLoading] = useState(true);\n\n  const supabase = createBrowserClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n  );\n\n  useEffect(() => {\n    // 1. Carga Inicial\n    const fetchOrder = async () => {\n      const { data, error } = await supabase\n        .from(\"orders\")\n        .select(\"*\")\n        .eq(\"id\", id)\n        .single();\n\n      if (error) {\n        console.error(\"Error al cargar:\", error);\n      } else {\n        setOrder(data);\n      }\n      setLoading(false);\n    };\n\n    fetchOrder();\n\n    // 2. SuscripciÃ³n Realtime con LOGS DE ESTADO\n    console.log(\"Intentando conectar al canal:\", `tracking-${id}`);\n    \n    const channel = supabase\n      .channel(`tracking-${id}`)\n      .on(\n        \"postgres_changes\",\n        {\n          event: \"UPDATE\", // Escuchamos actualizaciones\n          schema: \"public\",\n          table: \"orders\",\n          filter: `id=eq.${id}`, // Filtro exacto\n        },\n        (payload) => {\n          console.log(\"ðŸŸ¢ Â¡CAMBIO DETECTADO EN VIVO!\", payload.new);\n          // Forzamos actualizaciÃ³n fusionando datos\n          setOrder((prev: any) => ({ ...prev, ...payload.new }));\n        }\n      )\n      .subscribe((status) => {\n        // ESTO ES CLAVE: Te dirÃ¡ si se conectÃ³ o fallÃ³\n        console.log(`Estado de la conexiÃ³n Realtime: ${status}`);\n        \n        if (status === \"SUBSCRIBED\") {\n          console.log(\"âœ… Escuchando cambios...\");\n        } else if (status === \"CLOSED\") {\n          console.log(\"âŒ Desconectado\");\n        } else if (status === \"CHANNEL_ERROR\") {\n          console.log(\"âš ï¸ Error en el canal (Revisa ConfiguraciÃ³n de Supabase)\");\n        }\n      });\n\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, [id, supabase]);\n\n  if (loading)\n    return (\n      <div className=\"min-h-[100dvh] flex items-center justify-center bg-[#F8F9FA]\">\n        <Loader2 className=\"animate-spin text-orange-500\" size={40} />\n      </div>\n    );\n\n  if (!order)\n    return (\n      <div className=\"min-h-[100dvh] flex items-center justify-center text-gray-400 font-bold\">\n        Pedido no encontrado\n      </div>\n    );\n\n  // --- LÃ“GICA DE ESTADOS VISUALES ---\n  const getStatusColor = () => {\n    if (order.status === \"delivered\") return \"bg-green-500\";\n    if (\n      order.payment_status === \"paid\" ||\n      order.payment_status === \"on_account\"\n    )\n      return \"bg-emerald-500\";\n    return \"bg-orange-500\";\n  };\n\n  const getStatusIcon = () => {\n    if (order.status === \"delivered\") return <CheckCircle size={56} />;\n    if (order.payment_status === \"paid\") return <ChefHat size={56} />;\n    if (order.payment_status === \"on_account\") return <ChefHat size={56} />;\n    return <Clock size={56} className=\"animate-pulse\" />;\n  };\n\n  const getStatusTitle = () => {\n    if (order.status === \"delivered\") return \"Â¡Entregado!\";\n    if (order.payment_status === \"paid\") return \"Â¡Confirmado!\";\n    if (order.payment_status === \"on_account\") return \"Â¡Confirmado!\";\n    if (order.payment_method === \"yape\") return \"Verificando...\";\n    return \"Procesando...\";\n  };\n\n  const getStatusMessage = () => {\n    if (order.status === \"delivered\")\n      return \"Gracias por tu preferencia. Â¡Hasta la prÃ³xima!\";\n    if (order.payment_status === \"paid\")\n      return \"Tu orden estÃ¡ en cocina. Â¡Buen provecho!\";\n    if (order.payment_status === \"on_account\")\n      return \"El monto ha sido cargado a tu cuenta corriente.\";\n    if (order.payment_method === \"yape\")\n      return \"Estamos revisando el cÃ³digo de operaciÃ³n. No cierres esta ventana si deseas.\";\n    return \"Hemos recibido tu orden.\";\n  };\n\n  return (\n    <div className=\"min-h-[100dvh] bg-[#F8F9FA] pb-12 font-sans text-gray-900 flex flex-col\">\n      {/* NAVBAR */}\n      <div className=\"bg-white/80 backdrop-blur-md p-4 sticky top-0 z-20 border-b border-gray-200/50 flex items-center justify-between safe-area-top shadow-sm\">\n        <Link\n          href=\"/\"\n          className=\"p-2.5 bg-gray-100/80 hover:bg-gray-200 rounded-full transition-colors\"\n        >\n          <ArrowLeft size={20} className=\"text-gray-600\" />\n        </Link>\n        <div className=\"flex flex-col items-center\">\n          <span className=\"text-[10px] font-black text-gray-400 uppercase tracking-widest\">\n            Pedido NÂ°\n          </span>\n          <span className=\"text-sm font-black text-gray-900 font-mono tracking-tighter\">\n            {order.id.slice(0, 6).toUpperCase()}\n          </span>\n        </div>\n        <div className=\"w-10\"></div>\n      </div>\n\n      {/* LAYOUT RESPONSIVO (GRID) */}\n      <div className=\"max-w-5xl mx-auto p-4 md:p-8 w-full grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-12 items-start mt-4 flex-1\">\n        {/* COLUMNA IZQUIERDA: ESTADO GIGANTE (Sticky en PC) */}\n        <div className=\"lg:sticky lg:top-28\">\n          <motion.div\n            layout\n            initial={{ scale: 0.95, opacity: 0 }}\n            animate={{ scale: 1, opacity: 1 }}\n            className={`${getStatusColor()} text-white p-8 md:p-12 rounded-[2.5rem] shadow-2xl shadow-orange-900/10 relative overflow-hidden text-center transition-colors duration-500`}\n          >\n            <div className=\"absolute top-0 left-0 w-full h-full bg-white/10 backdrop-blur-3xl\"></div>\n\n            {/* CÃ­rculos decorativos de fondo */}\n            <div className=\"absolute -top-10 -right-10 w-40 h-40 bg-white/20 rounded-full blur-2xl\"></div>\n            <div className=\"absolute bottom-10 -left-10 w-32 h-32 bg-black/10 rounded-full blur-2xl\"></div>\n\n            <div className=\"relative z-10 flex flex-col items-center gap-6\">\n              <div className=\"bg-white/20 p-5 rounded-full backdrop-blur-md shadow-inner ring-1 ring-white/30\">\n                {getStatusIcon()}\n              </div>\n              <div>\n                <h1 className=\"text-3xl md:text-4xl font-black leading-tight mb-3 tracking-tight\">\n                  {getStatusTitle()}\n                </h1>\n                <p className=\"text-white/90 font-medium text-base md:text-lg leading-relaxed max-w-[300px] mx-auto\">\n                  {getStatusMessage()}\n                </p>\n              </div>\n\n              {/* CÃ³digo de verificaciÃ³n Yape */}\n              {order.payment_method === \"yape\" &&\n                order.payment_status === \"verifying\" && (\n                  <div className=\"mt-4 bg-black/20 px-5 py-3 rounded-2xl text-sm font-mono border border-white/10 backdrop-blur-sm animate-pulse\">\n                    <span className=\"opacity-70 text-xs block mb-1\">\n                      CÃ³digo enviado:\n                    </span>\n                    <span className=\"font-black tracking-widest text-lg\">\n                      {order.operation_code}\n                    </span>\n                  </div>\n                )}\n            </div>\n          </motion.div>\n\n          {/* BotÃ³n WhatsApp (Visible en PC debajo del estado) */}\n          <div className=\"hidden lg:block mt-8 text-center\">\n            <p className=\"text-sm text-gray-400 mb-3 font-medium\">\n              Â¿Necesitas ayuda con este pedido?\n            </p>\n            <a\n              href={`https://wa.me/51974805994?text=Hola, tengo una duda con mi pedido #${order.id.slice(0, 6)}`}\n              target=\"_blank\"\n              rel=\"noreferrer\"\n              className=\"inline-flex items-center gap-2 bg-white text-green-600 px-8 py-4 rounded-2xl font-bold text-base shadow-lg shadow-gray-200 hover:shadow-xl hover:scale-105 transition-all border border-gray-100\"\n            >\n              <MessageCircle size={20} /> Contactar Soporte\n            </a>\n          </div>\n        </div>\n\n        {/* COLUMNA DERECHA: DETALLES (Scrollable en PC) */}\n        <div className=\"space-y-6\">\n          {/* DATOS DE ENTREGA */}\n          <div className=\"bg-white p-6 md:p-8 rounded-[2.5rem] shadow-sm border border-gray-100\">\n            <h3 className=\"text-xs font-black text-gray-400 uppercase tracking-widest mb-5 flex items-center gap-2\">\n              <MapPin size={14} /> Datos de Entrega\n            </h3>\n            <div className=\"flex items-center gap-4\">\n              <div className=\"bg-orange-50 p-4 rounded-2xl text-orange-600\">\n                <MapPin size={24} />\n              </div>\n              <div>\n                <p className=\"font-black text-gray-900 text-xl leading-none mb-1\">\n                  {order.customer_name}\n                </p>\n                <div className=\"flex items-center gap-2 text-gray-500 font-bold bg-gray-50 px-2 py-1 rounded-lg w-fit text-sm mt-1\">\n                  {order.customer_office}\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* RESUMEN DEL PEDIDO */}\n          <div className=\"bg-white p-6 md:p-8 rounded-[2.5rem] shadow-sm border border-gray-100 relative overflow-hidden\">\n            {/* DecoraciÃ³n Ticket */}\n            <div className=\"absolute top-0 left-6 w-12 h-1 bg-orange-500 rounded-b-lg\"></div>\n\n            <h3 className=\"text-xs font-black text-gray-400 uppercase tracking-widest mb-6 flex items-center gap-2 mt-2\">\n              <Receipt size={14} /> Detalle del Consumo\n            </h3>\n\n            <div className=\"space-y-5 mb-6 border-b border-gray-100 pb-6 border-dashed\">\n              {order.items.map((item: any, i: number) => (\n                <div\n                  key={i}\n                  className=\"flex justify-between items-start text-sm md:text-base\"\n                >\n                  <div className=\"flex gap-4\">\n                    <span className=\"font-black text-gray-900 bg-gray-100 w-7 h-7 flex items-center justify-center rounded-lg text-xs mt-0.5\">\n                      {item.qty}\n                    </span>\n                    <div className=\"flex flex-col\">\n                      <span className=\"text-gray-800 font-bold leading-tight\">\n                        {item.name}\n                      </span>\n                      {item.options && (\n                        <div className=\"flex flex-wrap gap-1 mt-1\">\n                          {item.options.entrada && (\n                            <span className=\"text-[10px] bg-orange-50 text-orange-700 px-1.5 py-0.5 rounded border border-orange-100 font-bold\">\n                              {item.options.entrada}\n                            </span>\n                          )}\n                          {item.options.bebida && (\n                            <span className=\"text-[10px] bg-blue-50 text-blue-700 px-1.5 py-0.5 rounded border border-blue-100 font-bold\">\n                              {item.options.bebida}\n                            </span>\n                          )}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                  <span className=\"font-bold text-gray-900 font-mono\">\n                    S/ {(item.price * item.qty).toFixed(2)}\n                  </span>\n                </div>\n              ))}\n            </div>\n\n            <div className=\"flex justify-between items-center bg-gray-50 p-4 rounded-2xl\">\n              <span className=\"font-bold text-gray-500 text-sm uppercase tracking-wide\">\n                Total a Pagar\n              </span>\n              <span className=\"font-black text-3xl text-gray-900 tracking-tighter\">\n                S/ {order.total_amount.toFixed(2)}\n              </span>\n            </div>\n          </div>\n\n          {/* BotÃ³n WhatsApp (Solo MÃ³vil) */}\n          <div className=\"lg:hidden text-center pt-4 pb-8\">\n            <a\n              href={`https://wa.me/51974805994?text=Hola, tengo una duda con mi pedido #${order.id.slice(0, 6)}`}\n              target=\"_blank\"\n              rel=\"noreferrer\"\n              className=\"inline-flex items-center gap-2 bg-white text-green-600 px-6 py-3 rounded-full font-bold text-sm shadow-sm border border-gray-200 hover:bg-gray-50 transition-colors\"\n            >\n              <MessageCircle size={18} /> Â¿Problemas? Escribir al WhatsApp\n            </a>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}